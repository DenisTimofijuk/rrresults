import{a as E,d as b,u as C,g as L}from"./errorHandler-e9lLAunr.js";async function x(e,i,r){try{const n=await E.getAvailableCategories(i);r.innerHTML="";const s=document.createElement("option");s.value="",s.textContent="----",r.appendChild(s),r.value="",n.forEach(c=>{const u=document.createElement("option");u.value=c.id.toString(),u.textContent=c.name,r.appendChild(u)})}catch{b()}finally{e==null||e.classList.add("hide")}}function w(e){const i=document.createElement("table");i.classList.add("table","table-hover","table-bordered","table-sm");const r=document.createElement("thead");r.classList.add("table-light");const n=document.createElement("tr"),s=Object.keys(e[0]);if(s.forEach(u=>{const a=document.createElement("th");a.textContent=u,n.appendChild(a)}),e.some(u=>u.hasOwnProperty("actions"))){const u=document.createElement("th");u.textContent="Actions",n.appendChild(u)}r.appendChild(n),i.appendChild(r);const c=document.createElement("tbody");return e.forEach((u,a)=>{const m=document.createElement("tr");if(m.dataset.observationId=u.id.toString()||"",s.forEach(d=>{const t=document.createElement("td"),l=u[d];if(d==="url"&&l){const o=document.createElement("a");o.href=l.toString(),o.textContent="iNaturalist",o.target="_blank",t.appendChild(o)}else if(d==="points"){const o=document.createElement("div");o.classList.add("points-radio-group"),[0,.5,1].forEach(v=>{const h=document.createElement("input");h.type="radio",h.classList.add("form-check-input"),h.name=`points-radio-${a}`,h.id=`points-${a}-${v}`,h.value=v.toString(),h.checked=parseFloat(l.toString())===v;const f=document.createElement("label");f.classList.add("form-check-label","hover-pointer"),f.htmlFor=`points-${a}-${v}`,f.textContent=v.toString(),f.appendChild(h),o.appendChild(f)}),t.appendChild(o)}else if(d==="expert_review"){const o=document.createElement("textarea");o.value=(l==null?void 0:l.toString())||"",o.rows=2,o.cols=50,t.appendChild(o)}else t.textContent=(l==null?void 0:l.toString())||"";m.appendChild(t)}),u.hasOwnProperty("actions")){const d=document.createElement("td"),t=document.createElement("button");t.textContent="Edit",t.classList.add("btn","btn-sm","btn-primary","me-1"),t.addEventListener("click",()=>{console.log("Edit row:",a)}),d.appendChild(t);const l=document.createElement("button");l.textContent="Delete",l.classList.add("btn","btn-sm","btn-danger"),l.addEventListener("click",()=>{console.log("Delete row:",a),m.remove()}),d.appendChild(l),m.appendChild(d)}c.appendChild(m)}),i.appendChild(c),i}function I(e){const i=e.querySelectorAll("tbody tr"),r=1500;let n={},s=null,c={};const u=a=>{if(s!==a){if(s&&c[s]){const m=Array.from(i).find(d=>d.dataset.observationId===s);g(s,c[s],d=>{m&&y({row:m,isDataSaved:d})}),delete c[s],n[s]&&(window.clearTimeout(n[s]),delete n[s])}s=a}};i.forEach(a=>{const m=a.querySelectorAll('input[type="radio"]'),d=a.querySelector("textarea"),t=a.dataset.observationId;if(!t){console.error("Observation ID not found for row:",a);return}c[t]={},[...m,d].forEach(o=>{o.addEventListener("focus",()=>u(t))});const l=o=>{n[t]&&window.clearTimeout(n[t]),c[t]={...c[t],...o},n[t]=window.setTimeout(()=>{Object.keys(c[t]).length>0&&(g(t,c[t],p=>{y({row:a,isDataSaved:p})}),c[t]={})},r)};m.forEach(o=>{o.addEventListener("change",()=>{a.classList.remove("table-danger"),a.classList.remove("table-success"),l({points:parseFloat(o.value)})})}),d.addEventListener("change",()=>{var o;((o=c[t])==null?void 0:o.comments)!==void 0&&(g(t,{comments:d.value},p=>{y({row:a,isDataSaved:p})}),delete c[t].comments)}),d.addEventListener("input",()=>{a.classList.remove("table-danger"),a.classList.remove("table-success"),l({comments:d.value})})}),document.addEventListener("click",a=>{const m=a.target;e.contains(m)||s&&c[s]&&(g(s,c[s]),c[s]={})}),window.addEventListener("beforeunload",()=>{Object.keys(c).forEach(a=>{Object.keys(c[a]).length>0&&g(a,c[a])})})}async function g(e,i,r=()=>{}){if(!(i.points===void 0&&i.comments===void 0)&&e)try{const n=await E.saveExpertReview(parseInt(e),i);r(n.status===200)}catch(n){console.error("Error saving review data:",n),r(!1)}}function y(e){const{row:i,isDataSaved:r}=e;r?(i.classList.remove("table-danger"),i.classList.add("table-success")):(i.classList.remove("table-success"),i.classList.add("table-danger"))}async function S(e,i,r,n){try{e==null||e.classList.remove("hide");const s=await E.getObservations(r,n),c=w(s);I(c),i.appendChild(c)}catch{b()}finally{e==null||e.classList.add("hide")}}(async()=>{const e=document.getElementById("loader-wrapper"),i=document.getElementById("get-data"),r=document.getElementById("year-selected"),n=document.getElementById("category-selected"),s=document.getElementById("results"),c=document.getElementById("year-place-holder"),u=document.getElementById("category-place-holder");e==null||e.classList.remove("hide");try{(await E.getAvailableYears()).forEach(l=>{const o=document.createElement("option");o.value=l.toString(),o.textContent=l.toString(),r.appendChild(o)})}catch{b()}finally{e==null||e.classList.add("hide")}r.addEventListener("change",async()=>{const t=r.value;t&&(c.textContent=t,u.textContent="",e==null||e.classList.remove("hide"),x(e,t,n))}),n.addEventListener("change",async()=>{u.textContent=n.options[n.selectedIndex].text,i.disabled=n.value===""}),i.addEventListener("click",async()=>{!r.value||!n.value||(S(e,s,r.value,n.value),e==null||e.classList.add("hide"),C("year",r.value),C("category",n.value))});const a=L("year"),m=L("category");a&&(r.value=a,c.textContent=a,await x(e,a,n)),m&&(n.value=m,u.textContent=n.options[n.selectedIndex].text,i.disabled=n.value===""),a&&m?(i.disabled=!1,S(e,s,r.value,n.value)):i.disabled=!0;const d=document.getElementById("only-with-comments");d.addEventListener("change",()=>{const t=s.querySelector("table");t&&t.querySelectorAll("tr").forEach(o=>{const p=o.querySelector("textarea");p&&o.classList.toggle("hide",d.checked&&p.value==="")})})})();
