import{a as E,d as b}from"./errorHandler-CrSArjwa.js";function L(e,c){const i=new URL(window.location.href);i.searchParams.set(e,c),window.history.pushState({},"",i)}function C(e){return new URLSearchParams(window.location.search).get(e)}async function w(e,c,i){try{const n=await E.getAvailableCategories(c);i.innerHTML="";const s=document.createElement("option");s.value="",s.textContent="----",i.appendChild(s),i.value="",n.forEach(r=>{const u=document.createElement("option");u.value=r.id.toString(),u.textContent=r.name,i.appendChild(u)})}catch{b()}finally{e==null||e.classList.add("hide")}}function S(e){const c=document.createElement("table");c.classList.add("table","table-hover","table-bordered","table-sm");const i=document.createElement("thead");i.classList.add("table-light");const n=document.createElement("tr"),s=Object.keys(e[0]);if(s.forEach(u=>{const a=document.createElement("th");a.textContent=u,n.appendChild(a)}),e.some(u=>u.hasOwnProperty("actions"))){const u=document.createElement("th");u.textContent="Actions",n.appendChild(u)}i.appendChild(n),c.appendChild(i);const r=document.createElement("tbody");return e.forEach((u,a)=>{const m=document.createElement("tr");if(m.dataset.observationId=u.id.toString()||"",s.forEach(l=>{const t=document.createElement("td"),d=u[l];if(l==="observation-url"&&d){const o=document.createElement("a");o.href=d.toString(),o.textContent="iNaturalist",o.target="_blank",t.appendChild(o)}else if(l==="points"){const o=document.createElement("div");o.classList.add("points-radio-group"),[0,.5,1].forEach(v=>{const h=document.createElement("input");h.type="radio",h.classList.add("form-check-input"),h.name=`points-radio-${a}`,h.id=`points-${a}-${v}`,h.value=v.toString(),h.checked=parseFloat(d.toString())===v;const f=document.createElement("label");f.classList.add("form-check-label","hover-pointer"),f.htmlFor=`points-${a}-${v}`,f.textContent=v.toString(),f.appendChild(h),o.appendChild(f)}),t.appendChild(o)}else if(l==="expert_review"){const o=document.createElement("textarea");o.value=(d==null?void 0:d.toString())||"",o.rows=2,o.cols=50,t.appendChild(o)}else t.textContent=(d==null?void 0:d.toString())||"";m.appendChild(t)}),u.hasOwnProperty("actions")){const l=document.createElement("td"),t=document.createElement("button");t.textContent="Edit",t.classList.add("btn","btn-sm","btn-primary","me-1"),t.addEventListener("click",()=>{console.log("Edit row:",a)}),l.appendChild(t);const d=document.createElement("button");d.textContent="Delete",d.classList.add("btn","btn-sm","btn-danger"),d.addEventListener("click",()=>{console.log("Delete row:",a),m.remove()}),l.appendChild(d),m.appendChild(l)}r.appendChild(m)}),c.appendChild(r),c}function I(e){const c=e.querySelectorAll("tbody tr"),i=1500;let n={},s=null,r={};const u=a=>{if(s!==a){if(s&&r[s]){const m=Array.from(c).find(l=>l.dataset.observationId===s);g(s,r[s],l=>{m&&y({row:m,isDataSaved:l})}),delete r[s],n[s]&&(window.clearTimeout(n[s]),delete n[s])}s=a}};c.forEach(a=>{const m=a.querySelectorAll('input[type="radio"]'),l=a.querySelector("textarea"),t=a.dataset.observationId;if(!t){console.error("Observation ID not found for row:",a);return}r[t]={},[...m,l].forEach(o=>{o.addEventListener("focus",()=>u(t))});const d=o=>{n[t]&&window.clearTimeout(n[t]),r[t]={...r[t],...o},n[t]=window.setTimeout(()=>{Object.keys(r[t]).length>0&&(g(t,r[t],p=>{y({row:a,isDataSaved:p})}),r[t]={})},i)};m.forEach(o=>{o.addEventListener("change",()=>{a.classList.remove("table-danger"),a.classList.remove("table-success"),d({points:parseFloat(o.value)})})}),l.addEventListener("change",()=>{var o;((o=r[t])==null?void 0:o.comments)!==void 0&&(g(t,{comments:l.value},p=>{y({row:a,isDataSaved:p})}),delete r[t].comments)}),l.addEventListener("input",()=>{a.classList.remove("table-danger"),a.classList.remove("table-success"),d({comments:l.value})})}),document.addEventListener("click",a=>{const m=a.target;e.contains(m)||s&&r[s]&&(g(s,r[s]),r[s]={})}),window.addEventListener("beforeunload",()=>{Object.keys(r).forEach(a=>{Object.keys(r[a]).length>0&&g(a,r[a])})})}async function g(e,c,i=()=>{}){if(!(c.points===void 0&&c.comments===void 0)&&e)try{const n=await E.saveExpertReview(parseInt(e),c);i(n.status===200)}catch(n){console.error("Error saving review data:",n),i(!1)}}function y(e){const{row:c,isDataSaved:i}=e;i?(c.classList.remove("table-danger"),c.classList.add("table-success")):(c.classList.remove("table-success"),c.classList.add("table-danger"))}async function x(e,c,i,n){try{e==null||e.classList.remove("hide");const s=await E.getObservations(i,n),r=S(s);I(r),c.appendChild(r)}catch{b()}finally{e==null||e.classList.add("hide")}}(async()=>{const e=document.getElementById("loader-wrapper"),c=document.getElementById("get-data"),i=document.getElementById("year-selected"),n=document.getElementById("category-selected"),s=document.getElementById("results"),r=document.getElementById("year-place-holder"),u=document.getElementById("category-place-holder");e==null||e.classList.remove("hide");try{(await E.getAvailableYears()).forEach(d=>{const o=document.createElement("option");o.value=d.toString(),o.textContent=d.toString(),i.appendChild(o)})}catch{b()}finally{e==null||e.classList.add("hide")}i.addEventListener("change",async()=>{const t=i.value;t&&(r.textContent=t,u.textContent="",e==null||e.classList.remove("hide"),w(e,t,n))}),n.addEventListener("change",async()=>{u.textContent=n.options[n.selectedIndex].text,c.disabled=n.value===""}),c.addEventListener("click",async()=>{!i.value||!n.value||(x(e,s,i.value,n.value),e==null||e.classList.add("hide"),L("year",i.value),L("category",n.value))});const a=C("year"),m=C("category");a&&(i.value=a,r.textContent=a,await w(e,a,n)),m&&(n.value=m,u.textContent=n.options[n.selectedIndex].text,c.disabled=n.value===""),a&&m?(c.disabled=!1,x(e,s,i.value,n.value)):c.disabled=!0;const l=document.getElementById("only-with-comments");l.addEventListener("change",()=>{const t=s.querySelector("table");t&&t.querySelectorAll("tr").forEach(o=>{const p=o.querySelector("textarea");p&&o.classList.toggle("hide",l.checked&&p.value==="")})})})();
