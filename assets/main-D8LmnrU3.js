var x=Object.defineProperty;var f=(r,e,t)=>e in r?x(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>f(r,typeof e!="symbol"?e+"":e,t);import{u as v,g,a as y,d as b,h as E}from"./errorHandler-DLQvLM92.js";function I(r){const e=document.createElement("table");e.classList.add("table"),e.classList.add("table-hover"),e.classList.add("table-bordered"),e.classList.add("table-sm");const t=document.createElement("thead");t.classList.add("table-light");const l=document.createElement("tr");l.setAttribute("id","header-row"),["Komanda","Total"].forEach(a=>{const n=document.createElement("th");n.textContent=a,l.appendChild(n)}),t.appendChild(l),e.appendChild(t);const s=document.createElement("tbody");return r.sort((a,n)=>a.teamName.localeCompare(n.teamName)).forEach(a=>{const n=document.createElement("tr");n.dataset.team=a.teamName,[a.teamName,0].forEach(m=>{const u=document.createElement("th");u.textContent=(m==null?void 0:m.toString())||"",n.appendChild(u)}),s.appendChild(n)}),e.appendChild(s),e}class B{constructor(e,t){h(this,"currentColumnIndex",0);h(this,"isAnimating",!1);h(this,"visibleColumnProgress");this.results=e,this.table=t,this.results=e,this.table=t,this.visibleColumnProgress=document.getElementById("visible-column-progress")}updateSources(e,t){this.results=e,this.table=t,this.updateProgressDisplay()}updateProgressDisplay(){this.visibleColumnProgress.textContent=`${this.currentColumnIndex} / ${this.totalAvailableColumns}`}get totalAvailableColumns(){return this.results?Object.entries(this.results[0].data).length:0}hasMoreColumns(){return this.currentColumnIndex<this.totalAvailableColumns}resetProgress(){this.currentColumnIndex=0,this.isAnimating=!1,this.visibleColumnProgress.textContent=""}addColumnHeader(e){const t=document.createElement("th");t.textContent=this.results[0].data[e].title,this.table.tHead.rows.item(0).appendChild(t)}addColumnCell(e,t,l=!1){return new Promise(i=>{const o=[...this.table.tBodies[0].children].find(d=>d.dataset.team===e.teamName),a=document.createElement("td");o.appendChild(a),e.total||(e.total=0);const n=e.data[t].value;l?this.animateScoreCounting(a,n,()=>{e.total+=n,o.cells[1].textContent=e.total.toString(),i()}):(a.textContent=n.toString(),e.total+=n,o.cells[1].textContent=e.total.toString(),i())})}animateScoreCounting(e,t,l){let i=0;const s=Math.max(1,Math.ceil(t/20)),o=setInterval(()=>{i+=s,i>=t&&(i=t,clearInterval(o),l()),e.textContent=i.toString()},50)}updateTableSorting(){const e=[...this.results].sort((s,o)=>o.total-s.total),t=this.table.tBodies[0],l=[...t.children],i=l.map(s=>s.getBoundingClientRect().top);e.forEach(s=>{const o=l.find(a=>a.dataset.team===s.teamName);t.appendChild(o)}),l.forEach((s,o)=>{const a=s.getBoundingClientRect().top,n=i[o]-a;s.style.transition="none",s.style.transform=`translateY(${n}px)`,requestAnimationFrame(()=>{s.style.transition="transform 0.5s ease-in-out",s.style.transform="translateY(0)"})})}async revealNextColumnAnimated(){if(!this.hasMoreColumns()||this.isAnimating)return!1;this.isAnimating=!0,this.addColumnHeader(this.currentColumnIndex);const e=this.results.map(t=>this.addColumnCell(t,this.currentColumnIndex,!0));return await Promise.all(e),this.updateTableSorting(),this.currentColumnIndex++,this.isAnimating=!1,this.updateProgressDisplay(),v("column",this.currentColumnIndex.toString()),!0}revealColumnsUpToIndex(e){const t=this.totalAvailableColumns-1;if(e=Math.min(e-1,t),!(this.currentColumnIndex>e)){for(;this.currentColumnIndex<e;)this.addColumnHeader(this.currentColumnIndex),this.results.forEach(l=>{this.addColumnCell(l,this.currentColumnIndex,!1)}),this.currentColumnIndex++;this.revealNextColumnAnimated()}}}(async()=>{const r=document.getElementById("loader-wrapper"),e=document.getElementById("get-data-by-year"),t=document.getElementById("year-selected"),l=document.getElementById("reveal-next"),i=document.getElementById("results"),s=document.getElementById("year-place-holder"),o=g("column"),a=g("year");try{r.classList.remove("hide"),(await y.getAvailableYears()).forEach(C=>{const p=document.createElement("option");p.value=C.toString(),p.textContent=C.toString(),t.appendChild(p)}),r.classList.add("hide"),a&&(t.value=a,s.textContent=a)}catch{b()}let n=null,d=null;const m=new B(d,n);if(o&&a){await u(a);const c=parseInt(o);d&&n?(console.log("restoring progress",c),m.revealColumnsUpToIndex(c)):console.error("Error: unable to restore current progress. Missing column value or data or table is not yet initiated.")}l.addEventListener("click",()=>{d&&n&&m.revealNextColumnAnimated()}),e.addEventListener("click",async()=>{const c=t.value;c&&(v("year",t.value),E(),s.textContent=t.value,n&&(i.removeChild(n),m.resetProgress()),u(c))});async function u(c){try{r.classList.remove("hide"),l.classList.add("hide"),d=await y.getResultsByYear(c),n=I(d),m.updateSources(d,n),i.appendChild(n),r.classList.add("hide"),l.classList.remove("hide")}catch{b()}}})();
